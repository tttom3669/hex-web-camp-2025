---
import MainLayout from '../../layouts/MainLayout.astro'
import type { TBlogPost } from '../../pages/types/blog'

// 取得所有文章
const allPosts = await Astro.glob<TBlogPost>('../blogs/*.md')

// 取得網址參數中的 tag
const { tag } = Astro.params

// 篩選出包含該 tag 的文章
const filteredPosts = allPosts.filter((post) => post.frontmatter?.tags?.includes(tag))

// ✅ 加上 getStaticPaths，讓 Astro 知道要產出哪些頁面
export async function getStaticPaths() {
	const posts = await Astro.glob<TBlogPost>('../blogs/*.md')
	const tagSet = new Set<string>()

	for (const post of posts) {
		post.frontmatter?.tags?.forEach((t) => tagSet.add(t))
	}

	// 回傳所有 tag 組成的路徑
	return Array.from(tagSet).map((tag) => ({
		params: { tag }
	}))
}
---

<MainLayout title={`標籤: ${tag}`}>
	<h1>標籤: {tag}</h1>
	<ul>
		{filteredPosts.map((post) => <li>{post.frontmatter.title}</li>)}
	</ul>
</MainLayout>
